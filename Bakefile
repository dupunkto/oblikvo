#!/bin/bash -eu

trap clean 1 2 3 6 9

SRC="src/client/main.ts"
PUBLIC="public"
DIST="dist"

ESBUILD="esbuild $SRC"
ES_FLAGS="--bundle --outfile=$PUBLIC/main.js"

build() {
  clean
  $ESBUILD $ES_FLAGS 
  mkdir "$DIST"
  cp "$PUBLIC"/* "$DIST"/
}

clean() {
  p:clean_if_exists "$DIST"
  p:clean_if_exists "$PUBLIC"/main.js
}

p:clean_if_exists() {
  if [ -e "$1" ]; then
    rm -rf "$1"
  fi
}

serve() {
  clean
  node src/server/main.js &
  $ESBUILD $ES_FLAGS --watch
}

format() {
  prettier --write .
}
